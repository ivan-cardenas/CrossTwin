{% extends 'base.html' %} 
{% load static %} 
{% block title %}Map View{%endblock%}
 {% block extra_css %}
<link
  href="https://api.mapbox.com/mapbox-gl-js/v3.18.0/mapbox-gl.css"
  rel="stylesheet"
/>

<link rel="stylesheet" href="{% static '/css/mainMap.css' %}" />
{% endblock %}

{% block extra_js %}
<script src="https://api.mapbox.com/mapbox-gl-js/v3.18.0/mapbox-gl.js"></script>
<script src="{% static '/js/mainMap.js' %}"></script>
{% endblock %} 
{% block content %}

<div class="container-fluid py-3">
  <div class="row mb-3">
    <div class="col">
      <h2><i class="bi bi-map"></i> Map View</h2>
      <p class="text-muted">Visualize geographic features from the database</p>
    </div>
  </div>

  <div id="menu-container">
    <div class="map-controls">
      <h5
        id="controls-header"
        class="flex justify-between items-center cursor-pointer m-0"
      >
        <span><i class="bi bi-layers"></i> Layers</span>
        <i id="toggle-icon" class="bi bi-three-dots-vertical transition-transform duration-200"></i>
      </h5>

      <div
        id="controls-content"
        class="overflow-hidden transition-all duration-300 max-h-96 opacity-100"
      >
        <div id="layer-list">
          <div class="loading-layers">
            <div class="spinner-border text-primary" role="status"></div>
            <span><svg class="mr-3 size-5 animate-spin ..." viewBox="0 0 24 24">
            </svg></span><p class="mt-2 mb-0 small ">Loading layers...</p>
          </div>
        </div>
      </div>

      <div class="basemap-selector">
        <label for="basemap-select">Basemap</label>
        <select id="basemap-select">
          <option value="standard">Standard</option>
          <option value="streets">Streets</option>
          <option value="satellite">Satellite</option>
          <option value="outdoors">Outdoors</option>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </div>

      <div class="controls-footer">
        <button id="btn-select-all" title="Select All Layers">
          <i class="bi bi-check-all"></i> All
        </button>
        <button id="btn-select-none" title="Deselect All Layers">
          <i class="bi bi-x-lg"></i> None
        </button>
        <button id="btn-fit-all" title="Fit to All Visible">
          <i class="bi bi-arrows-fullscreen"></i> Fit
        </button>
      </div>

      <div class="map-loader" id="map-loader">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <span class="ms-2">Loading features...</span>
      </div>
    </div>

    <div id="map"></div>
  </div>
</div>

<script>
  // Initialize map with token from Django
  initializeMap("{{ mapbox_access_token }}");

  function initializeCollapsible() {

  const header = document.getElementById('controls-header');
  const content = document.getElementById('controls-content');
  const icon = document.getElementById('toggle-icon');

  console.log('Header:', header);  // Should NOT be null
  console.log('Content:', content);
  console.log('Icon:', icon);

  if (!header) {
    console.error('controls-header not found!');
    return;
  }

  header.addEventListener('click', function() {
    console.log('Header clicked!');  // Do you see this?
    content.classList.toggle('max-h-0');
    content.classList.toggle('max-h-96');
    content.classList.toggle('opacity-0');
    content.classList.toggle('opacity-100');
    icon.classList.toggle('rotate-180');
  });
};
  initializeCollapsible();
</script>

{% endblock content%}
